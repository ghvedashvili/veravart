<!doctype html>
<html lang="ka">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Screenshot swap demo</title>
  <style>
    :root{
      --bg: #ffffff;
      --text: #111;
      --fake-text-color: #b30000;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--text);
    }

    .container{
      padding:24px;
      max-width:900px;
      margin:0 auto;
    }

    /* --- Visible (normal) content --- */
    #realContent{
      border: 2px dashed #ddd;
      padding: 18px;
      border-radius: 8px;
      background: linear-gradient(#fff,#fbfbfb);
      box-shadow: 0 6px 20px rgba(0,0,0,0.05);
    }

    /* --- Fake content (shown only for screenshots/print/when detected) --- */
    #fakeContent{
      display:none; /* hidden by default */
      border: 2px solid #f0dede;
      padding: 18px;
      border-radius: 8px;
      background: linear-gradient(#fff8f8,#fff0f0);
      color: var(--fake-text-color);
      text-align:center;
      font-weight:700;
      font-size: 22px;
    }

    /* Small helper: show a visible temporary banner when fake is active */
    #fakeBanner{
      display:none;
      margin-top:12px;
      padding:8px;
      background:#fff0f0;
      border-radius:6px;
      color:var(--fake-text-color);
      font-weight:600;
    }

    /* If user prints the page (or when print mode is used), swap content */
    @media print {
      #realContent { display: none !important; }
      #fakeContent { display: block !important; }
      /* optionally enlarge */
      #fakeContent { font-size: 28px !important; }
      /* Avoid printing page chrome */
      body { background: #fff !important; color:#000 !important; }
    }

    /* Nice demo layout */
    .title { font-size:28px; margin-bottom:8px; }
    .note { color:#666; margin-bottom:12px; }

    /* Accessibility: animations off for reduced-motion */
    @media (prefers-reduced-motion: reduce) {
      * { transition: none !important; animation: none !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="realContent" aria-live="polite">
      <div class="title">ეს არის ნამდვილი ტექსტი — ეკრანზე ჩანს ჩვეულებრივ</div>
      <div class="note">ამრიგად მომხმარებელი ხედავს ამ ტექსტს. სქრინშოტის/პრინტის დროს შესაძლოა სხვა ტექსტი ჩანდეს — თუ გვერდის სკრიპტი/ბრაუზერი ამას დაუშვებს.</div>

      <p>
        ნიმუში: მომხმარებლის საკონტენტი, ინფორმაციები, ფორმები — ყველაფერი ნორმალურად. ქვემოთ მოცემულია ღილაკები ტესტირებისათვის.
      </p>

      <button id="testRevealBtn">ტესტურად დაუცე სქრინშოტისას შემოთხრენა (თვალით)</button>
      <button id="testPrintBtn" onclick="window.print()">პრინტ-მოდით ნახვა (სინჯისათვის)</button>
    </div>

    <div id="fakeContent" role="status" aria-hidden="true">
      <!-- აქ მიიტანე სქრინშოტისთვის გათვლილი ტექსტი -->
      სურათის ფარული ტექსტი — Copyright Valeri 2025
    </div>

    <div id="fakeBanner">სქრინშოტი დაფიქსირდა — სხვა ტექსტი ჩართულია</div>

    <hr style="margin:18px 0">

    <div style="font-size:13px;color:#666">
      შენიშვნა: ეს სკრიპტი ცდილობს დააფიქსიროს PrintScreen ღილაკი, სქრინშოტის კლავიატურის აქტი და iPhone-ის კონკრეტული ფრეიმ-გაფერხების ნიშნები. შედეგი მოწყობილობაზე განსხვავებული შეიძლება იყოს — ამიტომ რეკომენდირებულია შესამოწმებლად სხვადასხვა მოწყობილობებზე ტესტირება.
    </div>
  </div>

  <script>
    (function(){
      const real = document.getElementById('realContent');
      const fake = document.getElementById('fakeContent');
      const banner = document.getElementById('fakeBanner');
      const testRevealBtn = document.getElementById('testRevealBtn');

      let revealTimeout = null;
      const REVEAL_MS = 1400; // რამდენი მ industriya შეიცვლება სეკ.
      const COOLDOWN_MS = 2500; // როდის დაუბრუნდება ნორმალურ მდგომარეობას

      function revealFake(reason = 'detected') {
        // If already showing, extend timeout
        if (revealTimeout) {
          clearTimeout(revealTimeout);
        }

        // swap visibility
        real.style.display = 'none';
        fake.style.display = 'block';
        banner.style.display = 'block';
        fake.setAttribute('aria-hidden','false');

        // schedule revert
        revealTimeout = setTimeout(() => {
          fake.style.display = 'none';
          real.style.display = '';
          banner.style.display = 'none';
          fake.setAttribute('aria-hidden','true');
          revealTimeout = null;
        }, COOLDOWN_MS);
        console.log('Screenshot swap: revealed because ->', reason, '-', new Date().toISOString());
      }

      // --- Manual test button (for demo) ---
      testRevealBtn.addEventListener('click', function(){
        revealFake('manual-test');
      });

      // --- Detect PrintScreen key (Windows / desktop) ---
      // Note: detection of PrintScreen via keyup/keydown works in many desktop browsers.
      window.addEventListener('keyup', function(e){
        try {
          const key = e.key || e.code || '';
          // common identifiers: "PrintScreen", "PrintScrn"
          if (key === 'PrintScreen' || key === 'PrintScrn' || key === 'Print') {
            revealFake('PrintScreen-key');
          }
        } catch (err) {
          // ignore
        }
      });

      // Also try keydown (some browsers report on keydown)
      window.addEventListener('keydown', function(e){
        try {
          const key = e.key || e.code || '';
          if (key === 'PrintScreen' || key === 'PrintScrn' || key === 'Print') {
            revealFake('PrintScreen-keydown');
          }
        } catch (err) {}
      });

      // --- Detect clipboard change (rare) ---
      // On Windows, pressing PrintScreen sometimes places image into clipboard.
      // We can try to listen to "paste" event to detect if an image was pasted (user action).
      window.addEventListener('paste', function(e){
        const items = (e.clipboardData && e.clipboardData.items) || [];
        for (let i=0;i<items.length;i++){
          if (items[i].type && items[i].type.indexOf('image') !== -1) {
            revealFake('paste-image');
            break;
          }
        }
      });

      // --- Visibility / focus trick (for some mobile screenshots) ---
      // On iOS, when user takes a screenshot, sometimes the RAF loop is interrupted (frame gap)
      // We measure animation frame time differences to infer a screenshot.
      let lastRAF = performance.now();
      let rafCounter = 0;
      const GAP_THRESHOLD = 120; // ms threshold — tuned empirically (device-dependent)

      function rafDetect(now){
        const diff = now - lastRAF;
        // if diff is large, it's suspicious (could be screenshot / system modal)
        if (diff > GAP_THRESHOLD) {
          // On many iPhones, taking a screenshot causes a short pause/hiccup in RAF
          revealFake('raf-gap-'+Math.round(diff));
        }
        lastRAF = now;
        rafCounter++;
        requestAnimationFrame(rafDetect);
      }
      requestAnimationFrame(rafDetect);

      // --- Visibility change: user might switch apps / UI overlays appear on screenshot ---
      document.addEventListener('visibilitychange', function(){
        if (document.hidden) {
          // page hidden -> briefly show fake on return (best-effort)
          // We don't forcibly show immediately (to avoid false positives)
          console.log('visibilitychange:hidden ->', new Date().toISOString());
        } else {
          // when coming back into view, we might briefly show banner
          // (no strong detection here)
        }
      });

      // --- Extra: when printing via keyboard (Ctrl+P or Cmd+P), browsers often open print preview.
      window.addEventListener('beforeprint', function(){
        // Print preview about to open => swap to fake so print preview/pdfs capture fake.
        revealFake('beforeprint');
      });
      window.addEventListener('afterprint', function(){
        // after print — revert happens inside revealFake's timeout; ensure it's hidden
        console.log('afterprint', new Date().toISOString());
      });

      // --- Safety: don't spam console when running in background; keep low-impact ---
      // (already implemented: revealFake debounces with timeouts)

      // --- Optional: expose function for custom text replacement by other scripts ---
      window.__screenshotSwap = {
        revealFake,
        setFakeText: function(htmlOrText){
          if (typeof htmlOrText === 'string') {
            fake.innerHTML = htmlOrText;
          }
        }
      };

      // Example: set fake text dynamically (uncomment to test)
      // window.__screenshotSwap.setFakeText('პირადი: გათვალისწინებული ტექსტი — ' + new Date().toLocaleString());
    })();
  </script>
</body>
</html>