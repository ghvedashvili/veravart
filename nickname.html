<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kidsmart Nickname Game</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: #f0f8ff;
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 600px;
            width: 100%;
            background: white;
            border-radius: 15px;
            padding: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        
        h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.2rem;
            color: #2c3e50;
        }
        
        .password-container {
            margin-bottom: 30px;
            position: relative;
        }
        
        #passwordInput {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 3px solid #3498db;
            border-radius: 10px;
            outline: none;
            transition: all 0.3s;
            resize: vertical;
            min-height: 80px;
        }
        
        #passwordInput:disabled {
            background-color: #f5f5f5;
            border-color: #27ae60;
            color: #333;
        }
        
        #passwordInput:focus {
            border-color: #e74c3c;
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.3);
        }
        
        .char-counter {
            position: absolute;
            bottom: 10px;
            right: 15px;
            font-size: 0.9rem;
            color: #7f8c8d;
            background: rgba(255, 255, 255, 0.8);
            padding: 2px 8px;
            border-radius: 10px;
            transition: all 0.3s;
            opacity: 0;
            transform: translateY(10px);
        }
        
        .char-counter.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .char-counter.near-limit {
            color: #e67e22;
            font-weight: bold;
        }
        
        .char-counter.over-limit {
            color: #e74c3c;
            font-weight: bold;
            animation: pulse 0.5s ease-in-out;
        }
        
        .rules-container {
            margin-bottom: 20px;
            min-height: 60px;
        }
        
        .rule {
            margin: 10px 0;
            padding: 7px;
            border-radius: 8px;
            font-size: 0.7rem;
            font-weight: bold;
            transition: all 0.3s ease;
            border-left: 6px solid;
        }
        
        .rule.valid {
            background: #d4f8e8;
            color: #27ae60;
            border-left-color: #2ecc71;
        }
        
        .rule.invalid {
            background: #ffeaea;
            color: #e74c3c;
            border-left-color: #e74c3c;
            animation: pulse 0.5s ease-in-out;
        }
        
        .win-message {
            margin: 10px 0;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            background: #d4f8e8;
            color: #27ae60;
            border-left: 6px solid #2ecc71;
            text-align: center;
        }
        
        .copy-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .copy-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .copy-btn:hover {
            background: #2980b9;
        }
        
        .copy-btn.copied {
            background: #27ae60;
        }
        
        .copy-feedback {
            color: #27ae60;
            font-size: 0.9rem;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .copy-feedback.show {
            opacity: 1;
        }
        
        @keyframes pulse {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <h2>Nickname for Kidsmart</h2>
    
    <div class="container">
        <div class="password-container">
            <textarea id="passwordInput" placeholder="შეიყვანეთ Nickname" rows="3"></textarea>
            <div class="char-counter" id="charCounter">0/35</div>
        </div>
        
        <div class="rules-container" id="rulesContainer">
            <!-- წესები აქ დაიჯენერირდება JavaScript-ით -->
        </div>
        
        <div class="copy-section" id="copySection" style="display: none;">
            <button class="copy-btn" id="copyBtn">
                📋 კოპირება
            </button>
            <div class="copy-feedback" id="copyFeedback">დაკოპირებულია!</div>
        </div>
    </div>

    <script>
        // ყველა ქვეყნის ISO კოდები
        const allCountryCodes = [
           "AR",  "AZ", "GE",  "RU"
           ];

        // წესების მასივი
        const rules = [
            {
                id: 1,
                text: "Nickname უნდა შეიცავდეს მინიმუმ 5 სიმბოლოს",
                check: (pwd) => pwd.length >= 5
            },
            {
                id: 2,
                text: "Nickname უნდა შეიცავდეს ციფრს",
                check: (pwd) => /\d/.test(pwd)
            },
            {
                id: 3,
                text: "Nickname უნდა შეიცავდეს დიდ ასოს",
                check: (pwd) => /[A-Z]/.test(pwd)
            },
            {
                id: 4,
                text: "Nickname უნდა შეიცავდეს სპეციალურ სიმბოლოს",
                check: (pwd) => /[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(pwd)
            },
            {
                id: 5,
                text: "Nickname-ში ციფრების ჯამი უნდა იყოს 15",
                check: (pwd) => {
                    const numbers = pwd.match(/\d/g);
                    if (!numbers) return false;
                    return numbers.reduce((sum, num) => sum + parseInt(num), 0) === 15;
                }
            },
            {
                id: 6,
                text: "Nickname უნდა შეიცავდეს კვირის დღევანდელ დღეს (მინიმუმ 3 სიმბოლო)",
                check: (pwd) => {
                    const days = {
                        "SUN": ["SUNDAY", "კვირა", "კვი"],
                        "MON": ["MONDAY", "ორშაბათი", "ორშ"],
                        "TUE": ["TUESDAY", "სამშაბათი", "სამ"],
                        "WED": ["WEDNESDAY", "ოთხშაბათი", "ოთხ"],
                        "THU": ["THURSDAY", "ხუთშაბათი", "ხუთ"],
                        "FRI": ["FRIDAY", "პარასკევი", "პარ"],
                        "SAT": ["SATURDAY", "შაბათი", "შაბ"]
                    };

                    const today = new Date().getDay();
                    const todayKey = ["SUN", "MON", "TUE", "WED", "THU", "FRI", "SAT"][today];
                    const todayNames = [todayKey, ...days[todayKey]];

                    const pwdUpper = pwd.toUpperCase();

                    return todayNames.some(name => pwdUpper.includes(name.toUpperCase()));
                }
            },
            {
                id: 7,
                text: "Nickname უნდა შეიცავდეს ჭადრაკის ნოტაციას",
                check: (pwd) => /([a-h][1-8]|[nbrqk][a-h][1-8])/.test(pwd)
            },
            {
                id: 8,
                text: "Nickname უნდა შეიცავდეს მიმდინარე თვეს",
                check: (pwd) => {
                    const months = [
                        ["january", "jan", "იანვარი",  "იან"],
                        ["february", "feb", "თებერვალი",  "თებ"], 
                        ["march", "mar", "მარტი",  "მარ"],
                        ["april", "apr", "აპრილი",  "აპრ"],
                        ["may", "may", "მაისი",  "მაი"],
                        ["june", "jun", "ივნისი",  "ივნ"],
                        ["july", "jul", "ივლისი",  "ივლ"],
                        ["august", "aug", "აგვისტო",  "აგვ"],
                        ["september", "sep", "სექტემბერი",  "სექ"],
                        ["october", "oct", "ოქტომბერი",  "ოქტ"],
                        ["november", "nov", "ნოემბერი",  "ნოე"],
                        ["december", "dec", "დეკემბერი",  "დეკ"]
                    ];
                    const currentMonth = new Date().getMonth();
                    const currentMonthNames = months[currentMonth];
                    const pwdLower = pwd.toLowerCase();
                    return currentMonthNames.some(month => pwdLower.includes(month));
                }
            },
            {
                id: 9,
                text: "Nickname უნდა შეიცავდეს ემოჯის",
                check: (pwd) => /[\u{1F300}-\u{1F9FF}]/u.test(pwd)
            },
            {
                id: 10,
                text: "Nickname უნდა შეიცავდეს საქართველოს ან მისი მეზობელი ქვეყნის ISO კოდს",
                check: (pwd) => {
                    const pwdUpper = pwd.toUpperCase();
                    return allCountryCodes.some(country => pwdUpper.includes(country));
                }
            },
            {
                id: 11,
                text: "Nickname უნდა შეიცავდეს რომაულ ციფრს (მინიმუმ 3 სიმბოლო)",
                check: (pwd) => /[IVXLCDM]{3,}/i.test(pwd)
            },
            { 
                id: 12, 
                text: "Nickname-ის სიგრძე უნდა იყოს მაქსიმუმ 35 სიმბოლო (გაითვალისწინე emoji შეიძლება იკავებდეს 2 ადგილს)", 
                check: (pwd) => pwd.length <= 35 
            },
            {
                id: 13,
                text: "ყოველი მე-4 ასო უნდა იყოს დიდი",
                check: (pwd) => {
                    const letters = pwd.replace(/[^a-zA-Z]/g, '');
                    if (letters.length < 4) return false;
                    for (let i = 3; i < letters.length; i += 4) {
                        if (letters[i] !== letters[i].toUpperCase()) return false;
                    }
                    return true;
                }
            },
            {
                id: 14,
                text: "Nickname უნდა შეიცავდეს 3 ხმოვანს ზედიზედ",
                check: (pwd) => /[aeiouAEIOU]{3,}/.test(pwd)
            },
            {
                id: 15,
                text: "Nickname უნდა შეიცავდეს ათწილადს",
                check: (pwd) => /\d+\.\d+/.test(pwd)
            },
            {
                id: 27,
                text: "Nickname უნდა შეიცავდეს არითმეტიკულ მოქმედებას (+, -, *, /)",
                check: (pwd) => /[\+\-\*\/]/.test(pwd)
            },
            {
                id: 16,
                text: "Nickname არ უნდა შეიცავდეს ქართულ ასოებს",
                check: (pwd) => !/[ა-ჰ]/.test(pwd)
            },
            {
                id: 17,
                text: "Nickname არ უნდა შეიცავდეს მიმდევრობით ერთსა და იმავე სიმბოლოს 2-ზე მეტჯერ",
                check: (pwd) => {
                    for (let i = 0; i < pwd.length - 2; i++) {
                        if (pwd[i] === pwd[i+1] && pwd[i] === pwd[i+2]) {
                            return false;
                        }
                    }
                    return true;
                }
            },
            {
                id: 18,
                text: "Nickname უნდა შეიცავდეს ტემპერატურას (-375°C-დან 10000°C-მდე ან °F)",
                check: (pwd) => {
                    const tempRegex = /-?\d{1,5}°[CF]/;
                    const match = pwd.match(tempRegex);
                    if (!match) return false;
                    return true;
                }
            },
            {
                id: 19,
                text: "Nickname უნდა შეიცავდეს 💧-ს ან 🧂-ს ქიმიური ნაერთის კოდს",
                check: (pwd) => {
                    const compounds = ["H2O", "NaCl"];
                    const pwdUpper = pwd.toUpperCase();
                    return compounds.some(compound => pwdUpper.includes(compound.toUpperCase()));
                }
            },
            {
                id: 20,
                text: "Nickname უნდა შეიცავდეს საქართველოს ავტომობილების სტანდარტულ სარეგისტრაციო ნომერს",
                check: (pwd) => {
                    const plateRegex = /[A-Z]{2}-\d{3}-[A-Z]{2}/;
                    return plateRegex.test(pwd.toUpperCase());
                }
            },
            {
                id: 21,
                text: "Nickname-ში არ უნდა იყოს '41'",
                check: (pwd) => !pwd.includes("41")
            },
            {
                id: 22,
                text: "Nickname უნდა შეიცავდეს მარტივ 2 ნიშნა რიცხვს",
                check: (pwd) => {
                    const primes = ["11","13", "17","19","23", "29", "31", "37", "41", "43", "47", "53", "59", "61", "67", "71", "73", "79", "83", "89", "97"];
                    return primes.some(prime => pwd.includes(prime));
                }
            },
            {
                id: 23,
                text: "Nickname უნდა შეიცავდეს ციფრულ დროს (12:34, 23:59)",
                check: (pwd) => {
                    const timeRegex = /([01]?[0-9]|2[0-3]):[0-5][0-9]/;
                    return timeRegex.test(pwd);
                }
            },
            {
                id: 24,
                text: "Nickname-ში აკრძალულია კოდი RU (რუსეთი ოკუპანტია)",
                check: (pwd) => !pwd.toUpperCase().includes("RU")
            },
            {
                id: 25,
                text: "Nickname კენტი და ლუწი ციფრები უნდა იყოს თანაბარი რაოდენობის",
                check: (pwd) => {
                    const numbers = pwd.match(/\d/g);
                    if (!numbers) return false;
                    const evenCount = numbers.filter(num => parseInt(num) % 2 === 0).length;
                    const oddCount = numbers.filter(num => parseInt(num) % 2 !== 0).length;
                    return evenCount === oddCount;
                }
            },
            {
                id: 26,
                text: "Nickname-ში ციფრების ნამრავლი 0-ზე მეტი უნდა იყოს",
                check: (pwd) => {
                    const numbers = pwd.match(/\d/g);
                    if (!numbers || numbers.length === 0) return false;
                    return numbers.reduce((product, num) => product * parseInt(num), 1) > 0;
                }
            }
        ];

        // DOM ელემენტები
        const passwordInput = document.getElementById('passwordInput');
        const rulesContainer = document.getElementById('rulesContainer');
        const charCounter = document.getElementById('charCounter');
        const copySection = document.getElementById('copySection');
        const copyBtn = document.getElementById('copyBtn');
        const copyFeedback = document.getElementById('copyFeedback');

        // ინიციალიზაცია
        let allRules = [...rules];
        let activeRules = [allRules[0]]; // მხოლოდ პირველი წესი
        let completedRules = new Set();
        let gameWon = false;

        // Copy-Paste-Cut ბლოკირება მხოლოდ როცა თამაში მიმდინარეობს
        passwordInput.addEventListener('copy', (e) => {
            if (!gameWon) {
                e.preventDefault();
                alert('Copy აკრძალულია! თქვენ უნდა თავად აკრიფოთ Nickname.');
            }
        });

        passwordInput.addEventListener('paste', (e) => {
            if (!gameWon) {
                e.preventDefault();
                alert('Paste აკრძალულია! თქვენ უნდა თავად აკრიფოთ Nickname.');
            }
        });

        passwordInput.addEventListener('cut', (e) => {
            if (!gameWon) {
                e.preventDefault();
                alert('Cut აკრძალულია!');
            }
        });

        // კოპირების ფუნქცია
        function copyPassword() {
            const password = passwordInput.value;
            
            // ვქმნით დროებით input ელემენტს კოპირებისთვის
            const tempInput = document.createElement('input');
            tempInput.value = password;
            document.body.appendChild(tempInput);
            tempInput.select();
            tempInput.setSelectionRange(0, 99999); // მობილურისთვის
            
            try {
                // ვცდილობთ კოპირებას
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopyFeedback();
                }
            } catch (err) {
                console.error('კოპირება ვერ მოხერხდა: ', err);
            }
            
            // ვშლით დროებით input-ს
            document.body.removeChild(tempInput);
            
            // ასევე ვცდილობთ ახალი Clipboard API-ის გამოყენებით
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(password).catch(err => {
                    console.error('Clipboard API error: ', err);
                });
            }
        }

        function showCopyFeedback() {
            copyBtn.textContent = '✅ კოპირებული!';
            copyBtn.classList.add('copied');
            copyFeedback.classList.add('show');
            
            setTimeout(() => {
                copyBtn.textContent = '📋 კოპირება';
                copyBtn.classList.remove('copied');
                copyFeedback.classList.remove('show');
            }, 2000);
        }

        // სიმბოლოების მთველის განახლება
        function updateCharCounter() {
            const password = passwordInput.value;
            const length = password.length;
            const maxLength = 35;
            
            charCounter.textContent = `${length}/${maxLength}`;
            
            // ფერის ცვლილება ლიმიტის მიხედვით
            charCounter.classList.remove('near-limit', 'over-limit');
            
            if (length > maxLength) {
                charCounter.classList.add('over-limit');
            } else if (length > maxLength - 5) {
                charCounter.classList.add('near-limit');
            }
        }

        // სიმბოლოების მთველის ხილვადობის კონტროლი
        function toggleCharCounter() {
            const rule12Active = activeRules.some(rule => rule.id === 12);
            
            if (rule12Active) {
                charCounter.classList.add('visible');
                updateCharCounter();
            } else {
                charCounter.classList.remove('visible');
            }
        }

        // გამარჯვების შემოწმება
        function checkWin(password) {
            return allRules.every(rule => rule.check(password));
        }

        // გამარჯვების ფუნქცია
        function showWinState() {
            gameWon = true;
            
            // გავაუმოქმედოთ textarea
            passwordInput.disabled = true;
            
            // დავამალოთ ყველა წესი
            rulesContainer.innerHTML = '';
            
            // დავამატოთ გილოცვის შეტყობინება
            const winMessage = document.createElement('div');
            winMessage.className = 'win-message';
            winMessage.textContent = 'გილოცავთ! თქვენ წარმატებით შექმენით Nickname!';
            rulesContainer.appendChild(winMessage);
            
            // გამოვაჩინოთ კოპირების სექცია
            copySection.style.display = 'flex';
        }

        // წესების დამატება DOM-ში
        function renderRules() {
            if (gameWon) return;
            
            rulesContainer.innerHTML = '';
            
            const password = passwordInput.value;
            
            // დავალაგოთ წესები: ჯერ შეუსრულებელი, შემდეგ შესრულებული
            const sortedRules = [...activeRules].sort((a, b) => {
                const aValid = a.check(password);
                const bValid = b.check(password);
                if (!aValid && bValid) return -1; // a (შეუსრულებელი) ზევით
                if (aValid && !bValid) return 1;  // b (შეუსრულებელი) ზევით
                return a.id - b.id; // იგივე სტატუსი - თანმიმდევრობით
            });
            
            // მხოლოდ აქტიური წესების ჩვენება
            sortedRules.forEach(rule => {
                const ruleElement = document.createElement('div');
                const isValid = rule.check(password);
                ruleElement.className = `rule ${isValid ? 'valid' : 'invalid'}`;
                ruleElement.textContent = rule.text;
                rulesContainer.appendChild(ruleElement);
            });
            
            // გამარჯვების შემოწმება
            if (checkWin(password)) {
                showWinState();
            }
        }

        // პაროლის შემოწმება
        function checkPassword() {
            const password = passwordInput.value;
            
            // განვაახლოთ სიმბოლოების მთველი (მხოლოდ თუ წესი 12 აქტიურია)
            if (activeRules.some(rule => rule.id === 12)) {
                updateCharCounter();
            }
            
            // განვაახლოთ დასრულებული წესები
            allRules.forEach(rule => {
                if (rule.check(password)) {
                    completedRules.add(rule.id);
                } else {
                    completedRules.delete(rule.id);
                }
            });
            
            // მიმდინარე აქტიური წესების შემოწმება
            let allActiveRulesCompleted = activeRules.every(rule => rule.check(password));
            
            // თუ ყველა აქტიური წესი დასრულებულია, მოვძებნოთ შემდეგი შეუსრულებელი წესი
            if (allActiveRulesCompleted) {
                const nextRule = allRules.find(rule => 
                    !activeRules.includes(rule) && !rule.check(password)
                );
                if (nextRule) {
                    activeRules.push(nextRule);
                    // განვაახლოთ სიმბოლოების მთველი, თუ ახალი წესია 12
                    toggleCharCounter();
                }
            }
            
            renderRules();
        }

        // ავტომატური სუბმიტი ყოველი ცვლილებისას
        passwordInput.addEventListener('input', function() {
            if (!gameWon) {
                checkPassword();
            }
        });

        // კოპირების ღილაკის მოვლენა
        copyBtn.addEventListener('click', copyPassword);

        // თამაშის დაწყება
        toggleCharCounter();
        renderRules();
    </script>
</body>
</html>
