<!DOCTYPE html>
<html lang="ka">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Incognito + Blow â€” áƒ£áƒ™áƒ”áƒ—áƒ”áƒ¡áƒ˜ áƒ“áƒ”áƒ¢áƒ”áƒ¥áƒªáƒ˜áƒ</title>
<style>
  body{font-family: Arial, sans-serif;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;margin:0;background:#f7fbff;color:#111}
  #msg{font-size:18px;margin-bottom:12px;text-align:center;max-width:90%}
  #bubble{width:140px;height:140px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff,#6cc1ff 40%,#2a8bd1 100%);display:flex;align-items:center;justify-content:center;font-weight:bold;color:#033;box-shadow:0 8px 20px rgba(0,0,0,0.12);transition:transform .2s,opacity .2s}
  .popped{transform:scale(.12);opacity:0}
  #controls{margin-top:14px}
  button{padding:8px 12px;font-size:14px;margin:6px}
  small{display:block;margin-top:10px;color:#666}
</style>
</head>
<body>
  <div id="msg">áƒ˜áƒœáƒ™áƒáƒ’áƒœáƒ˜áƒ¢áƒ áƒ“áƒ”áƒ¢áƒ”áƒ¥áƒªáƒ˜áƒ â€” áƒ¢áƒ”áƒ¡áƒ¢áƒ˜ áƒ˜áƒ¬áƒ§áƒ”áƒ‘áƒ...</div>
  <div id="bubble">áƒ‘áƒ£áƒ¨áƒ¢áƒ˜</div>
  <div id="controls">
    <button id="start">áƒ¡áƒ¢áƒáƒ áƒ¢áƒ˜</button>
    <button id="stop" disabled>áƒ¡áƒ¢áƒáƒ</button>
  </div>
  <small id="debug" aria-hidden="true"></small>

<script>
/*
  áƒ«áƒšáƒ˜áƒ”áƒ áƒ˜ áƒ˜áƒœáƒ™áƒáƒ’áƒœáƒ˜áƒ¢áƒ áƒ“áƒ”áƒ¢áƒ”áƒ¥áƒªáƒ˜áƒ â€” áƒ›áƒ áƒáƒ•áƒáƒš áƒ°áƒ”áƒ˜áƒ¡áƒ¢áƒ˜áƒ™áƒ£áƒ  áƒ¢áƒ”áƒ¡áƒ¢áƒ”áƒ‘áƒ–áƒ” áƒ“áƒáƒ¤áƒ£áƒ«áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜.
  áƒ§áƒ£áƒ áƒáƒ“áƒ¦áƒ”áƒ‘áƒ: áƒáƒ áƒªáƒ”áƒ áƒ—áƒ˜ áƒ›áƒ”áƒ—áƒáƒ“áƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡ 100% â€” áƒ–áƒáƒ’áƒ˜ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ˜ purposefully áƒáƒ¢áƒ§áƒ£áƒ”áƒ‘áƒ¡.
  áƒáƒ› áƒ™áƒáƒ“áƒ˜áƒ¡ áƒáƒ›áƒáƒªáƒáƒœáƒ: áƒ’áƒáƒ–áƒáƒ áƒ“áƒáƒ¡ áƒáƒšáƒ‘áƒáƒ—áƒáƒ‘áƒ áƒ“áƒ áƒ›áƒáƒáƒ©áƒ•áƒ”áƒœáƒáƒ¡ áƒ’áƒáƒœáƒ¡áƒ®áƒ•áƒáƒ•áƒ”áƒ‘áƒ£áƒšáƒ˜ UI áƒ—áƒ£ áƒ˜áƒœáƒ™áƒáƒ’áƒœáƒ˜áƒ¢áƒáƒ.
*/

const msg = document.getElementById('msg');
const debug = document.getElementById('debug');
const bubble = document.getElementById('bubble');
const startBtn = document.getElementById('start');
const stopBtn  = document.getElementById('stop');

let audioCtx, analyser, dataArray, source, rafId, stream;
let blowCooldown = false;

startBtn.addEventListener('click', async () => {
  startBtn.disabled = true;
  msg.textContent = 'áƒ˜áƒœáƒ™áƒáƒ’áƒœáƒ˜áƒ¢áƒ áƒ˜áƒªáƒœáƒáƒ‘áƒ... áƒ’áƒ—áƒ®áƒáƒ• áƒ“áƒáƒ˜áƒªáƒáƒ“áƒ áƒ¬áƒáƒ›áƒ˜';
  const inc = await detectIncognitoRobust();
  if (inc) {
    msg.textContent = 'ğŸ•µï¸ áƒ¨áƒ”áƒœ áƒ˜áƒœáƒ™áƒáƒ’áƒœáƒ˜áƒ¢áƒáƒ¨áƒ˜ áƒ®áƒáƒ  â€” áƒ¡áƒáƒ”áƒªáƒ˜áƒ¤áƒ˜áƒ™áƒ£áƒ áƒ˜ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ áƒáƒ¥.';
    document.body.style.background = '#0b1220';
    document.body.style.color = '#cfeffd';
  } else {
    msg.textContent = 'ğŸŒ áƒ©áƒ•áƒ”áƒ£áƒš áƒ áƒ”áƒŸáƒ˜áƒ›áƒ¨áƒ˜ áƒ®áƒáƒ  â€” áƒ‘áƒ£áƒ¨áƒ¢áƒ˜ áƒ›áƒ–áƒáƒ“áƒáƒ áƒ¨áƒ”áƒ‘áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡.';
    document.body.style.background = '#f7fbff';
    document.body.style.color = '#111';
  }

  // áƒ¨áƒ”áƒœáƒ˜áƒ¨áƒ•áƒœáƒ: áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’ áƒ•áƒáƒ áƒ¡áƒ”áƒ‘áƒáƒ‘áƒ— áƒ›áƒ˜áƒ™áƒ áƒáƒ¤áƒáƒœáƒ˜áƒ¡ áƒ¤áƒ£áƒœáƒ¥áƒªáƒ˜áƒáƒ¡ áƒ¡áƒ£áƒš áƒáƒ áƒ˜áƒ•áƒ” áƒ¨áƒ”áƒ›áƒ—áƒ®áƒ•áƒ”áƒ•áƒáƒ¨áƒ˜
  await startMic();
  stopBtn.disabled = false;
});

stopBtn.addEventListener('click', stopMic);

async function startMic(){
  try {
    stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  } catch (e) {
    msg.textContent = 'áƒ›áƒ˜áƒ™áƒ áƒáƒ¤áƒáƒœáƒ˜áƒ¡ áƒ¬áƒ•áƒ“áƒáƒ›áƒ áƒ£áƒáƒ áƒ§áƒáƒ¤áƒ˜áƒšáƒ˜áƒ áƒáƒœ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒáƒáƒ•áƒ”áƒ‘áƒ.';
    startBtn.disabled = false;
    stopBtn.disabled = true;
    return;
  }
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 2048;
  dataArray = new Float32Array(analyser.fftSize);
  source = audioCtx.createMediaStreamSource(stream);
  source.connect(analyser);

  msg.textContent = 'áƒ›áƒ˜áƒ™áƒ áƒáƒ¤áƒáƒœáƒ˜ ON â€” áƒ¨áƒ£áƒ‘áƒ”áƒ áƒ˜áƒ¡ áƒ’áƒáƒ¡áƒáƒ’áƒ”áƒ‘áƒáƒ“ áƒ›áƒ–áƒáƒ“ áƒ•áƒáƒ .';
  tick();
}

function stopMic(){
  if (stream) stream.getTracks().forEach(t=>t.stop());
  if (audioCtx) audioCtx.close();
  cancelAnimationFrame(rafId);
  msg.textContent = 'áƒ›áƒ˜áƒ™áƒ áƒáƒ¤áƒáƒœáƒ˜ áƒ’áƒáƒ—áƒ˜áƒ¨áƒ£áƒšáƒ˜áƒ.';
  startBtn.disabled = false;
  stopBtn.disabled = true;
  bubble.classList.remove('popped');
}

function getRMS(buffer){
  let sum=0;
  for (let i=0;i<buffer.length;i++){const v=buffer[i]; sum+=v*v;}
  return Math.sqrt(sum/buffer.length);
}

function tick(){
  analyser.getFloatTimeDomainData(dataArray);
  const rms = getRMS(dataArray);
  const perc = Math.min(1, rms*500);
  // áƒœáƒáƒªáƒ áƒáƒ“ áƒ•áƒ˜áƒ–áƒ£áƒáƒšáƒ˜ (áƒ—áƒ¥áƒ•áƒ”áƒœ áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒáƒ— áƒ“áƒáƒáƒ›áƒáƒ¢áƒáƒ— meter)
  // debug.innerText = 'RMS: ' + rms.toFixed(4);
  if (!blowCooldown && rms > 0.03) {
    // áƒ›áƒáƒ áƒ¢áƒ˜áƒ•áƒ˜ áƒáƒ›áƒáƒªáƒœáƒáƒ‘áƒ â€” áƒ›áƒ™áƒ•áƒ”áƒ—áƒ áƒ˜ áƒ®áƒ›áƒ
    triggerBlow();
  }
  rafId = requestAnimationFrame(tick);
}

function triggerBlow(){
  blowCooldown = true;
  bubble.classList.add('popped');
  setTimeout(()=>{ bubble.classList.remove('popped'); }, 500);
  setTimeout(()=>{ blowCooldown = false; }, 800);
}

/* ========================
  Incognito detection (robust)
   - áƒáƒ¬áƒáƒ áƒ›áƒáƒ”áƒ‘áƒ¡ áƒ áƒáƒ›áƒ“áƒ”áƒœáƒ˜áƒ›áƒ” áƒ¢áƒ”áƒ¡áƒ¢áƒ¡ áƒ“áƒ áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ¡ {incognito:bool, details:array}
   - áƒ™áƒáƒœáƒ¡áƒáƒšáƒ¨áƒ˜ áƒ“áƒ debug-áƒ¨áƒ˜ áƒ’áƒáƒ›áƒáƒáƒ¥áƒ•áƒ¡ áƒ“áƒ”áƒ¢áƒáƒšáƒ”áƒ‘áƒ˜
   - áƒ–áƒáƒ’áƒ˜ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ˜ áƒ¨áƒ”áƒ˜áƒ«áƒšáƒ”áƒ‘áƒ áƒ£áƒªáƒ”áƒ‘ áƒ“áƒáƒáƒ¡áƒ¬áƒ áƒ (false negatives), áƒáƒ›áƒ˜áƒ¢áƒáƒ› áƒ•áƒ˜áƒ§áƒ”áƒœáƒ”áƒ‘áƒ— áƒ®áƒ›áƒáƒ¡
   ======================== */

async function detectIncognitoRobust() {
  const results = [];

  // 1) Storage estimate áƒ¢áƒ”áƒ¡áƒ¢áƒ˜
  try {
    if (navigator.storage && navigator.storage.estimate) {
      const est = await navigator.storage.estimate();
      const quota = est.quota || 0;
      // Safari incognito áƒ›áƒáƒ áƒ—áƒšáƒ áƒáƒ‘áƒáƒšáƒáƒœáƒ¡áƒ”áƒ‘áƒ¡ áƒ›áƒªáƒ˜áƒ áƒ” quota â€” áƒ›áƒáƒ’áƒ áƒáƒ› áƒ”áƒ¡ áƒáƒ  áƒáƒ’áƒ áƒ”áƒ¡áƒ˜áƒ£áƒšáƒ˜ áƒœáƒáƒ áƒ›áƒáƒšáƒ£áƒ  Android-áƒ–áƒ”
      const res = quota < 120_000_000; // 120MB
      results.push({name:'storageEstimate', value:res, raw:quota});
    } else {
      results.push({name:'storageEstimate', value:null, raw:null});
    }
  } catch (e) { results.push({name:'storageEstimate', value:true, error:e.toString()}); }

  // 2) IndexedDB áƒ¢áƒ”áƒ¡áƒ¢áƒ˜
  try {
    const idb = await new Promise(resolve => {
      let opened = false;
      try {
        const req = indexedDB.open('incognito_test_' + Date.now());
        req.onsuccess = ()=> { if(!opened){ opened=true; req.result.close(); resolve(false);} };
        req.onerror = ()=> { if(!opened){ opened=true; resolve(true);} };
        req.onupgradeneeded = ()=> { /* áƒ¬áƒáƒ áƒ›áƒáƒ¢áƒ”áƒ‘áƒ˜áƒ— áƒ¥áƒ›áƒœáƒ˜áƒ¡ DB â€” áƒœáƒ˜áƒ¨áƒœáƒáƒ•áƒ¡ áƒœáƒáƒ áƒ›áƒáƒšáƒ£áƒ  áƒ áƒ”áƒŸáƒ˜áƒ›áƒ¡ */ };
        // áƒáƒ¡áƒ”áƒ•áƒ” timebound: áƒ—áƒ£ áƒáƒ  áƒ›áƒáƒ“áƒ˜áƒ¡ áƒáƒáƒ¡áƒ£áƒ®áƒ˜, áƒ¨áƒ”áƒ•áƒ£áƒ¨áƒ•áƒ”áƒ‘áƒ— false
        setTimeout(()=> { if(!opened){ opened=true; resolve(false);} }, 700);
      } catch(e){ resolve(true); }
    });
    results.push({name:'indexedDB', value:idb});
  } catch(e){ results.push({name:'indexedDB', value:true, error:e.toString()}); }

  // 3) FileSystem API (webkit) áƒ¢áƒ”áƒ¡áƒ¢áƒ˜ (Chrome/Old Safari)
  try {
    const fs = window.RequestFileSystem || window.webkitRequestFileSystem;
    if (fs) {
      const res = await new Promise(r => {
        fs(window.TEMPORARY, 100, ()=> r(false), ()=> r(true));
        // áƒ›áƒáƒ™áƒšáƒ” timeout fallback
        setTimeout(()=> r(false), 700);
      });
      results.push({name:'fileSystem', value:res});
    } else results.push({name:'fileSystem', value:null});
  } catch(e) { results.push({name:'fileSystem', value:true, error:e.toString()}); }

  // 4) Cookie áƒ‘áƒáƒ“áƒ” â€” áƒ–áƒáƒ’ áƒ˜áƒœáƒ™áƒáƒ’áƒœáƒ˜áƒ¢áƒáƒ¨áƒ˜ third-party cookie áƒ›áƒªáƒ˜áƒ áƒ“áƒ”áƒ‘áƒ, áƒ›áƒáƒ’áƒ áƒáƒ› áƒ”áƒ¡ áƒ›áƒ™áƒáƒ¤áƒ˜áƒ áƒáƒ  áƒáƒ áƒ˜áƒ¡.
  try {
    document.cookie = "incogTest=1; SameSite=Lax";
    const has = document.cookie.indexOf('incogTest=1') !== -1;
    results.push({name:'cookieWritable', value: !has ? true : false, raw: document.cookie});
    // áƒ¬áƒáƒ•áƒ¨áƒáƒšáƒ”áƒ—
    document.cookie = "incogTest=; Max-Age=0";
  } catch(e) { results.push({name:'cookieWritable', value:null, error:e.toString()}); }

  // 5) Performance/navigation timing trick â€” áƒ˜áƒœáƒ™áƒáƒ’áƒœáƒ˜áƒ¢áƒáƒ¨áƒ˜ áƒ–áƒáƒ’áƒ¯áƒ”áƒ  resource timing áƒáƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒ–áƒ¦áƒ£áƒ“áƒ£áƒšáƒ˜
  try {
    const perf = performance && performance.getEntries ? performance.getEntries().length : null;
    results.push({name:'perfEntries', value: perf !== null && perf < 5, raw: perf});
  } catch(e){ results.push({name:'perfEntries', value:null, error:e.toString()}); }

  // 6) User agent / features quick checks
  try {
    // iOS Safari: storage quota small + indexedDB fails often â€” already covered.
    const ua = navigator.userAgent || '';
    results.push({name:'userAgent', value:null, raw: ua});
  } catch(e){ results.push({name:'userAgent', value:null}); }

  // Decide: áƒ—áƒ˜áƒ—áƒáƒ”áƒ£áƒš áƒáƒáƒ–áƒ˜áƒ¢áƒ˜áƒ£áƒ  áƒ¢áƒ”áƒ¡áƒ¢áƒ¡ áƒ•áƒáƒœáƒ˜áƒ­áƒ”áƒ‘áƒ— 1 áƒ¥áƒ£áƒšáƒáƒ¡; áƒœáƒ”áƒ˜áƒ¢áƒ áƒáƒšáƒ¡ 0; áƒœáƒ”áƒ’áƒáƒ¢áƒ˜áƒ£áƒ áƒ¡ -1
  let score = 0;
  const details = [];
  for (const t of results) {
    let val = t.value;
    let point = 0;
    if (val === true) point = 1;
    else if (val === false) point = -1;
    else point = 0;
    score += point;
    details.push({test: t.name, value: t.value, raw: t.raw ?? null, point});
  }

  // debug
  debug.innerText = 'Detect details: ' + JSON.stringify(details, null, 2);

  // áƒ§áƒ£áƒ áƒáƒ“áƒ áƒ”áƒ‘áƒ: áƒáƒ“áƒ áƒ˜áƒœáƒ“áƒ”áƒšáƒ˜ áƒ’áƒáƒ›áƒáƒªáƒ“áƒ˜áƒšáƒ”áƒ‘áƒ˜áƒ— score >= 1 áƒ®áƒ¨áƒ˜áƒ áƒáƒ“ áƒœáƒ˜áƒ¨áƒœáƒáƒ•áƒ¡ áƒ˜áƒœáƒ™áƒáƒ’áƒœáƒ˜áƒ¢áƒáƒ¡, >=2 â€” áƒ«áƒšáƒ˜áƒ”áƒ  áƒ”áƒ­áƒ•áƒ˜.
  const incognito = score >= 1;

  // áƒáƒ¡áƒ”áƒ•áƒ” áƒáƒ•áƒ‘áƒ”áƒ­áƒ“áƒáƒ— console-áƒ¨áƒ˜ (áƒ“áƒ”áƒ•áƒ”áƒšáƒáƒáƒ”áƒ áƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡)
  console.log('Incognito detection score:', score, details);

  return incognito;
}

/* Notes:
 - áƒ–áƒáƒ’áƒ˜ áƒ‘áƒ áƒáƒ£áƒ–áƒ”áƒ áƒ˜ (áƒáƒ®áƒáƒšáƒ˜ Safari, newest Chrome) purposefully áƒáƒ  áƒ’áƒáƒ›áƒáƒ˜áƒ áƒ©áƒ”áƒ•áƒ â€” áƒ˜áƒ¡áƒ˜áƒœáƒ˜ purposefully áƒáƒ©áƒ”áƒ áƒ”áƒ‘áƒ”áƒœ áƒáƒ› áƒ¢áƒ”áƒ¡áƒ¢áƒ”áƒ‘áƒ¡.
 - áƒ—áƒ£ áƒ™áƒáƒœáƒ™áƒ áƒ”áƒ¢áƒ£áƒšáƒáƒ“ iOS Safari-áƒ–áƒ” áƒ•áƒ”áƒ  áƒ˜áƒªáƒœáƒáƒ‘áƒ—, áƒ¡áƒªáƒáƒ“áƒ”áƒ— áƒ¨áƒ”áƒ¡áƒ—áƒáƒ•áƒáƒ–áƒáƒ— áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ¡ áƒ›áƒªáƒ˜áƒ áƒ” áƒ“áƒáƒ¨áƒ•áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ˜áƒ—
   (áƒ›áƒáƒ’. "áƒ®áƒáƒ áƒ— áƒ˜áƒœáƒ™áƒáƒ’áƒœáƒ˜áƒ¢áƒáƒ¨áƒ˜?" áƒ‘áƒ£áƒ¢áƒáƒœáƒ˜) â€” áƒ›áƒáƒ’áƒ áƒáƒ› áƒ”áƒ¡ UX-áƒ˜áƒ.
 - áƒ”áƒ¡ áƒ™áƒáƒ“áƒ˜ áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ¡ boolean; áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒáƒ— áƒ¨áƒ”áƒªáƒ•áƒáƒšáƒáƒ— decision thresholds.
*/
</script>
</body>
</html>