<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ინკოგნიტო დეტექცია + ტექსტი</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 50px; }
    #message { font-size: 24px; color: #333; }
  </style>
</head>
<body>
  <div id="message">პირდაპირ ვგეგმავ რეჟიმის შესამოწმებლად…</div>

  <script>
    async function detectIncognitoMode() {
      // მრავალჰეისტიკური მიდგომა
      const results = [];

      // ტესტი 1: storageEstimate
      if (navigator.storage && navigator.storage.estimate) {
        try {
          const { quota } = await navigator.storage.estimate();
          // მაგალითად: ინკოგნიტოში შესაძლოა კვოტა ნაკლები იყოს
          results.push({ test: 'storageEstimate', value: quota < 120_000_000, raw: quota });
        } catch(e) {
          results.push({ test: 'storageEstimate', value: null, error: e.toString() });
        }
      } else {
        results.push({ test: 'storageEstimate', value: null });
      }

      // ტესტი 2: indexedDB
      try {
        const dbReq = indexedDB.open('test-incognito');
        let isError = false;
        dbReq.onerror = () => { isError = true; };
        dbReq.onsuccess = () => { /* ok */ };
        await new Promise(r => setTimeout(r, 500));
        results.push({ test: 'indexedDB', value: isError, raw: isError });
      } catch(e) {
        results.push({ test: 'indexedDB', value: true, error: e.toString() });
      }

      // დასკვნა
      // თუ ერთ-ზე მეტი ტესტი მიუთითებს ინკოგნიტოზე → მივიჩნიოთ “ინკოგნიტო რეჟიმი”
      let countTrue = results.reduce((c, r) => (r.value === true ? c+1 : c), 0);
      const isIncognito = (countTrue >= 1);
      console.log('Incognito detection results:', results, '→', isIncognito);
      return isIncognito;
    }

    (async () => {
      const messageEl = document.getElementById('message');
      const incog = await detectIncognitoMode();

      if (incog) {
        messageEl.textContent = "შენ INCOGNITO რეჟიმში ხარ — სპეციალური ტექსტი აქაა.";
      } else {
        messageEl.textContent = "შენ ჩვეულ რეჟიმში ხარ — ჩვეულებრივი ტექსტი.";
      }
    })();
  </script>
</body>
</html>